---
title: "Bellabeat Capstone Project"
author: "Felipe Cortés"
date: '2022-03-29'
output: html_document
---



```{r Libraries, include=FALSE}
library(readr)
library(tidyverse)
library(dplyr)
library(ggplot2)
library(skimr)
library(lubridate)
library(janitor)
```


## HOW CAN BELLABEAT PLAY IT SMART

### ASK

**1. About Bellabeat.**

Bellabeat is the go-to wellness brand for women with an ecosystem of products and services focused on women’s health. Through its products, Bellabeat collects data on activity, sleep, stress, and reproductive health of users, which empowers women with knowledge about their own health and habits.They develop wearables and accompanying products that monitor biometric and lifestyle data to help women better understand how their bodies work and make healthier choices. Its products include the Bellabeat app, Leaf (a wellness tracker worn as a bracelet, necklace or clip), Time (a wellness watch) and spring (a water bottle). 

**2.  What is the problem you are trying to solve?**

As a data analyst I am trying to determine the best possible course to follow regarding Bellabeat’s product marketing strategy based on how users are currently using smart devices and provide high level recommendations for how these trends can unlock potential new growth opportunities.

**3. How can your insights drive business decisions?**

Identifying how smart devices are being used will allow the Marketing and Design team to strengthen specific Bellabeat’s product features.

**4. Key Stakeholders**

Urška Sršen: Bellabeat’s co-founder and Chief Creative Officer.
Sandro Mur: Bellabeat’s co-founder.
Bellabeat’s marketing team.


### PREPARE


**1. About the Dataset**

**Crowd-sourced Fitbit datasets 03.12.2016-05.12.2016**

These datasets were generated by respondents to a distributed survey via Amazon Mechanical Turk between 03.12.2016-05.12.2016.  Thirty eligible Fitbit users consented to the submission of personal tracker data, including minute-level output for physical activity, heart rate, and sleep monitoring. Individual reports can be parsed by export session ID (column A) or timestamp (column B).  Variation between output represents use of different types of Fitbit trackers and individual tracking behaviours / preferences. 

Furberg, R., Brinton, J., Keating, M., & Ortiz, A. (2016). Crowd-sourced Fitbit datasets 03.12.2016-05.12.2016 [Data set]. Zenodo. <https://doi.org/10.5281/zenodo.53894>

Creative Commons Attribution 4.0 International, Kaggle: CC0: Public Domain.

The data is long as each row is one time point per subject, with each subject having multiple rows.



```{r loading data, include=FALSE}

daily_activity <- read_csv("~/Data Analysis/Capstone/Fitabase Data 4.12.16-5.12.16/dailyActivity_merged.csv")
daily_calories <- read_csv("~/Data Analysis/Capstone/Fitabase Data 4.12.16-5.12.16/dailyCalories_merged.csv")
daily_steps <- read_csv("~/Data Analysis/Capstone/Fitabase Data 4.12.16-5.12.16/dailySteps_merged.csv")
daily_sleep <- read_csv("~/Data Analysis/Capstone/Fitabase Data 4.12.16-5.12.16/sleepDay_merged.csv")
heart_rate_seconds <- read_csv("~/Data Analysis/Capstone/Fitabase Data 4.12.16-5.12.16/heartrate_seconds_merged.csv")
weight_log_info <- read_csv("~/Data Analysis/Capstone/Fitabase Data 4.12.16-5.12.16/weightLogInfo_merged.csv")
```


#### Previewing Datasets



```{r previewing data, echo=TRUE}
head(daily_activity, 10)
head(daily_calories, 10)
head(daily_steps, 10)
head(heart_rate_seconds, 10)
head(daily_sleep, 10)
head(weight_log_info, 10)
```


### PROCESS

1. First we take a look at the sample size.

```{r sample size, echo=FALSE}
n_distinct(daily_activity$Id)
n_distinct(daily_calories$Id)
n_distinct(daily_steps$Id)
n_distinct(heart_rate_seconds$Id)
n_distinct(daily_sleep$Id)
n_distinct(weight_log_info$Id) 
```

We notice that all numbers differ from the description of the dataset, being 30 participants, so we must doubt of the integrity and credibility of the dataset.

#### Removing Duplicates

2. Then we check for duplicates.

```{r duplicates}
sum(duplicated(daily_activity))
sum(duplicated(daily_calories))
sum(duplicated(daily_steps))
sum(duplicated(heart_rate_seconds))
sum(duplicated(daily_sleep))
sum(duplicated(weight_log_info))
```

3. Now we remove the duplicates in the sleep_day dataset.


```{r remove duplicates}
daily_sleep <- daily_sleep %>%
  distinct() %>%
  drop_na()
```


4. We check again for duplicates.

```{r rechecking duplicates}
sum(duplicated(daily_sleep))
```

#### Correcting Date Format

5. Now we start by splitting up date and time and naming all date columns as 'Date' to work better with our data sets.


```{r separating date and time}
daily_sleep <- daily_sleep %>% 
  separate(SleepDay, c("Date", "Time"), " ")

heart_rate_seconds <- heart_rate_seconds %>% 
  separate(Time, c("Date", "Time"), " ")

weight_log_info <- weight_log_info %>% 
    separate(Date, c("Date", "Time"), " ")
```

6. And we change all remaining date column names to 'Date'.

```{r naming into Date}
# Changing all date columns to 'Date'
daily_activity <- rename(daily_activity, Date = ActivityDate)

daily_calories <- rename(daily_calories, Date = ActivityDay)

daily_steps <- rename(daily_steps, Date = ActivityDay)
```


7. Next we noticed that the date is formatted as characters and not as dates so we changed the format.

```{r formatting data}
daily_activity$Date <- mdy(daily_activity$Date)
daily_calories$Date <- mdy(daily_calories$Date)
daily_sleep$Date <- mdy(daily_sleep$Date)
daily_steps$Date <- mdy(daily_steps$Date)
heart_rate_seconds$Date <- mdy(heart_rate_seconds$Date)
weight_log_info$Date <- mdy(weight_log_info$Date)
```

#### Checking Credibility of the Data

8. Now we check if there are inconsistencies in the number of rows.

```{r number of rows}
nrow(daily_activity)
nrow(daily_calories)
nrow(daily_sleep)
nrow(daily_steps)
nrow(heart_rate_seconds)
nrow(weight_log_info)
```

9. We proceed to check for missing values in all of the tables.

```{r missing values}
sum(is.na(daily_activity))
sum(is.na(daily_calories))
sum(is.na(daily_sleep))
sum(is.na(daily_steps))
sum(is.na(heart_rate_seconds))
sum(is.na(weight_log_info))
```
We get 65 missing values in the weight_log_info table. We check the missing values and discover that the missing values are in the 'Fat' column.

#### Transforming Data

```{r checking NA}
is.na(weight_log_info)
```

10. We decide to exclude the 'Fat' column from the analysis.

```{r elimintating FAT}
weight_log_info <- subset(weight_log_info, select = -Fat)
colnames(weight_log_info)
```
11. Now we join the tables with the same amount of observations (daily_activity, daily_calories, daily_steps) in order to have a single table to make future analysis easier. To merge daily_steps correctly we renamed StepTotal column to TotalSteps.

```{r}
daily_steps <- rename(daily_steps, TotalSteps = StepTotal)
daily_overall <- merge(daily_activity, daily_calories,by = c("Id", "Date", "Calories"))
daily_overall <- merge(daily_overall, daily_steps,by = c("Id", "Date", "TotalSteps"))
head(daily_overall)
```


### ANALYSE

1. First of all, we evaluated some general information about our newly created and cleaned dataset in order to identify some highlights and starting points.


```{r}
summary(daily_overall)
```

2. The general glimpse of the data led to a series of initial hypotheses which would open our view to deeper analysis.

We then wondered:
+ How does the correlation look between burnt calories and daily steps?
+ Is there a correlation between daily steps and sleeping time?
+ Is there a correlation between sleeping longer and burning more calories?
+ Is there a correlation between a sedentary lifestyle and sleeping time?
+ How does the correlation look between weight and burnt calories?

In the following graphics we will evaluate the different hypotheses.


```{r}
ggplot(data= daily_overall, aes(x=TotalSteps, y=Calories)) +
  geom_point(alpha= .5, color="blue") +
  geom_smooth(fill= "green") +
  labs(title= "Correlation Betweeen Steps and Calories", subtitle = "Walking more burns more calories", caption = "period from [2016-04-12] to [2016-05-12]")
```



```{r include=FALSE}
activity_vs_sleep <- merge(daily_activity, daily_sleep, by= c("Id", "Date"))
overall_vs_sleep <- merge(daily_overall, daily_sleep, by= c("Id", "Date"))
```

#### Correlation Betweeen Steps and Sleep


```{r warning=FALSE}
ggplot(data= activity_vs_sleep, aes(x=TotalSteps, y=TotalMinutesAsleep)) +
  geom_point(alpha= .5, color="blue") +
  geom_smooth(fill= "yellow") +
  labs(title= "Correlation Betweeen Steps and Sleep", subtitle = " No Correlation Between Sleeping time and Steps", caption = "period from [2016-04-12] to [2016-05-12]")
```


#### Correlation Betweeen Burnt Calories and Sleep

```{r warning=FALSE}
ggplot(data= activity_vs_sleep, aes(x=Calories, y=TotalMinutesAsleep)) +
  geom_point(alpha= .5, color="blue") +
  geom_smooth(fill= "yellow") +
  labs(title= "Correlation Betweeen Burnt Calories and Sleep", subtitle = " No Correlation Between Sleeping longer and burning more calories", caption = "period from [2016-04-12] to [2016-05-12]")
```


#### Correlation Betweeen a Sedentary lifestyle and Sleep

```{r warning=FALSE}
ggplot(data= overall_vs_sleep, aes(x=SedentaryMinutes, y=TotalMinutesAsleep)) +
  geom_point(alpha= .5, color="blue") +
  geom_smooth(fill= "red") +
  labs(title= "Correlation Betweeen a Sedentary lifestyle and Sleep", subtitle = " The more sedentary we are the less we sleep", caption = "period from [2016-04-12] to [2016-05-12]")
```


#### Correlation Betweeen Weight and Burnt Calories


```{r include=FALSE}
weight_vs_activity<- merge(weight_log_info, daily_overall, by= c("Id", "Date"))
```

```{r}
ggplot(data= weight_vs_activity, aes(x=WeightKg, y=Calories)) +
  geom_point(alpha= .5, color="blue") +
  geom_smooth(fill= "red") +
  labs(title= "Correlation Betweeen Weight and Burnt Calories", caption = "period from [2016-04-12] to [2016-05-12]")
```


We noticed in this last plot a value that altered completely the visualization. Therefore we decided to eliminate the value and run the plot again. This is the result:


```{r}
weight_vs_activity_cleaned <- weight_vs_activity[!(weight_vs_activity$Id=="1927972279"),]

ggplot(data= weight_vs_activity_cleaned, aes(x=WeightKg, y=Calories)) +
  geom_point(alpha= .5, color="blue") +
  geom_smooth(fill= "green") +
  labs(title= "Correlation Betweeen Weight and Burnt Calories", subtitle = "Cleaned", caption = "period from [2016-04-12] to [2016-05-12]")
```


The plot shows an alleged correlation between weight and burnt calories. But to draw any conclusions from this data would require more information.


3. One of the main objectives of our analysis is to determine the best possible course to follow regarding Bellabeat’s product marketing strategy based on how users are currently using smart devices. Therefore, we decided to analyse the frequency of use of the device.

```{r}
daily_use <- activity_vs_sleep %>%
  group_by(Id) %>%
  summarize(days_used=sum(n())) %>%
  mutate(usage = case_when(
    days_used >= 1 & days_used <= 10 ~ "low use",
    days_used >= 11 & days_used <= 20 ~ "moderate use", 
    days_used >= 21 & days_used <= 31 ~ "high use", 
  ))
  
head(daily_use)
```

```{r}
daily_use_percent <- daily_use %>%
  group_by(usage) %>%
  summarise(total = n()) %>%
  mutate(totals = sum(total)) %>%
  group_by(usage) %>%
  summarise(total_percent = total / totals) %>%
  mutate(labels = scales::percent(total_percent))

daily_use_percent$usage <- factor(daily_use_percent$usage, levels = c("high use", "moderate use", "low use"))

head(daily_use_percent)
```
```{r}
daily_use_percent %>%
  ggplot(aes(x="",y=total_percent, fill=usage)) +
  geom_bar(stat = "identity", width = 1)+
  coord_polar("y", start=0)+
  theme_minimal()+
  theme(axis.title.x= element_blank(),
        axis.title.y = element_blank(),
        panel.border = element_blank(), 
        panel.grid = element_blank(), 
        axis.ticks = element_blank(),
        axis.text.x = element_blank(),
        plot.title = element_text(hjust = 0.5, size=14, face = "bold")) +
  geom_text(aes(label = labels),
            position = position_stack(vjust = 0.5))+
  scale_fill_manual(values = c("#63a6b9","#f68121", "#576eb2"),
                    labels = c("High use - 21 to 31 days",
                                 "Moderate use - 11 to 20 days",
                                 "Low use - 1 to 10 days"))+
  labs(title="Daily use of smart device")
```


#### Conclusions: Daily Use of Smart Devices


The analysis demonstrated that a majority of the evaluated sample uses their device more than 20 days. But it also shows. Bellabeat might need to address specifically why is people not using their device everyday or even for sleeping. This allows us to make a couple of recommendations.

+ Run more tests with the UX design department to determine if the cause of the low use may lie on design or discomfort that it might bring. 
+ Does the device have enough battery to allow the user to keep it with them for a longer time?
+ Is the device fashionable enough? Can it be used at any occasion? 


#### Analysing Hear Rate


Our next analysis brought us to the heart rate of the users. Due to the sample size, We first chose a random user and display on a graph how heart rate looks throughout the day.

```{r}
sample_heartrate <- heart_rate_seconds %>% filter(Id == 2022484408) %>% select(Id, Date, Time, Value)

sample_heartrate <- sample_heartrate %>% filter(Date == "2016-04-12")

ggplot(data = sample_heartrate, mapping = aes(x = Time, y = Value)) + geom_point()
```

When we saw the irregular variation of the heart rate during the day made us wonder if this hear rate was characteristic of a healthy person. Upon further investigation, we learned that, in fact, healthy people tend to have higher heart rate variability. This is at the same time translated into:

+ Greater willpower 
+ Positive mood 
+ High resilience 
+ Overall wellness and healthfulness 
+ High productivity 

On the other hand, having lower heart rate variability scores could lead the body to experience:

+ Diminished willpower
+ Negative mood
+ Low resilience
+ Overall poor health
+ Low productivity

Source: https://www.kosmotime.com/heart-rate-variability/#How_to_Use_Heart_Rate_Variability_for_Greater_Productivity

#### Conclusions: Heart Rate

Bellabeat could use their devices to track heart rate and alert the users of unusual  variations. Whenever a person is experiencing lower heart rate variability scores, the app should trigger an alert and deliver some suggestions based on the historical data of the user. This information could also be helpful to guide the user to calmer states of mind.

As seen in the plot, there is a spike in hear rate. The device could also follow and identify abnormal, recurrent spikes on the heart rate and inform the user of possible risks to allow the person to find the source of the spikes.

